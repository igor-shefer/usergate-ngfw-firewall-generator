# Generator_FW — Генератор и очиститель правил Firewall

Краткое описание
- В репозитории находятся два основных скрипта для работы с XML-RPC API UTM/NGFW:
  - `generator_firewall.py` — генерирует автоматизированно сервисы, IP-списки и правила межсетевого экрана (FW). Поддерживает многопоточность, пакетную отправку и логирование.
  - `cleanup_firewall.py` — удаляет объекты, созданные генератором (правила, сервисы, именованные IP-списки). Также использует многопоточность и сохраняет лог работы.

Требования
- Python 3.8+ (рекомендуется)
- Установленные зависимости:
  - `tqdm` — индикаторы прогресса

Установка зависимостей
```bash
pip3 install tqdm
```

Настройка
- Откройте соответствующий скрипт и отредактируйте параметры подключения и параметры генерации:
  - В `generator_firewall.py`:
    - `ADDRESS`, `PORT`, `LOGIN`, `PASSWORD` — адрес, порт и учётные данные XML-RPC API.
    - `NUM_RULES`, `NUM_SUBNETS`, `NUM_SERVICES` — количество генерируемых правил / подсетей / сервисов.
    - `BATCH_SIZE`, `THREADS_COUNT` — размер пакетов и количество потоков.
    - `STARTING_NETWORK_BASE` — начальный IP для генерации подсетей (например `10.0.0.0`).
  - В `cleanup_firewall.py`:
    - `ADDRESS`, `PORT`, `LOGIN`, `PASSWORD` — адрес и учётные данные для подключения к API.
    - `FIREWALL_RULE_NAME_PREFIX`, `IP_LIST_NAME_PREFIX`, `SERVICE_NAME_PREFIX` — префиксы, по которым скрипт определяет объекты для удаления. Подгоните под префиксы, используемые генератором (по умолчанию `Rule_`, `AutoGen_Net_`, `Auto_Service_TCP_`).
    - `DELETE_THREADS_COUNT`, `BATCH_DELETE_SIZE` — количество потоков и размер пакета удаления.

### ! Рекомендуемые параметры для генерация правил Firewall смотрите в таблице скрипта generator_firewall.py

# --- Дополнительные параметры работы ------------


Требования на стороне NGFW / UTM
- Убедитесь, что на устройстве включён и доступен сервис XML-RPC управления (в примерах — административная веб-консоль и опция `zone-xml-rpc`). В документации вашего устройства (например, UserGate) описано, как включить XML-RPC.

Запуск
- Для генератора:
```bash
python3 generator_firewall.py
```
- Для очистки (удаляет объекты с соответствующими префиксами):
```bash
python3 cleanup_firewall.py
```

Логи и результаты
- `generator_firewall.py` по завершении сохраняет подробный лог в `api.log` (в той же директории скрипта).
- `cleanup_firewall.py` сохраняет лог работы в `cleanup.log`.

Рекомендации и заметки
- Тестируйте сначала на небольших значениях (`NUM_RULES`, `NUM_SUBNETS`, `NUM_SERVICES`) чтобы убедиться в корректности шаблонов и параметров.
- Не оставляйте в коде реальные пароли в репозитории — сохраняйте учетные данные в защищённом месте или используйте переменные окружения при необходимости.
- Если при пакетной операции API возвращает ошибки о лимите элементов, уменьшите `BATCH_SIZE`.
- Скрипты уже обрабатывают типовые ошибки (например, 409 для дубликатов) и пытаются повторить запросы при временных сбоях.

Где смотреть код
- `generator_firewall.py` — генерация сервисов, IP-списков и правил с логикой пакетной отправки и многопоточности.
- `cleanup_firewall.py` — поиск и удаление объектов по префиксам, сохранение логов, отчёт в конце выполнения.


