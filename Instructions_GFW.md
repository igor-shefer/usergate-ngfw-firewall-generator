1. **Настройка и Запуск generator_firewall.py:**
    *   Установите дополнительную библиотеку tqdm командой:  pip3 install tqdm
    *   Установите пользовательские настройки в generator_firewall.py в разделе Параметры пользователя: IP-адрес и порт NGFW, учетные данные администратора, количество правил, подсетей, статус проверки сертификата если используется HTTPS подключение на 4443 порт, количество сервисов для создания, начальный IP-адрес для генерации подсетей и сохранить.
    *   При настройке используйте рекомендуемые параметры для генерация правил Firewall из указанной таблицы в скрипте, в зависисмости от количества правил  в firewall.
    *   Настройки многопоточности, размер группы пакетов, таймер и количество повторных попыток при разрыве соединений рекомендуется оставить по умолчанию. 
    *   На стороне NGFW откройте веб-консоль администратора таким образом: https://<usergate_ip>:8001/?features=zone-xml-rpc. В настройках нужной зоны активировать сервис "XML-RPC для управления" в зависимости от требований HTTP или HTTPS, более подробно описано на сайте https://docs.usergate.com/nastrojka-servisa-xml-rpc_800.html
    *   Запустите скрипт командой: python3 generator_firewall.py
    *   Дождитесь окончания работы скрипта на  основании статус бара tqdm.
    *   Просмотрите подробный отчет api.log, создаваемый в этой же директории, где находится generator_firewall.py.
    *   Если требуется, после окончания всех работ удалите созданные правила и обьекты скриптом cleanup_firewall.py из п.8.

2.  **Как работает обращение к API:**
    *   Скрипт формирует URL для подключения к XML-RPC API UTM.
    *   Если вызов API завершается ошибкой (например, сетевой сбой, таймаут, ошибка сервера 5xx), функция делает паузу (с экспоненциально увеличивающимся временем) и повторяет попытку (до 5 раз по умолчанию). Это помогает справиться с временными проблемами сети или кратковременной перегрузкой UTM.
    * Для передачи всех правил и обьектов используется многопоточность `THREADS_COUNT` для увелечения скорости передачи правил и обьектов. 
    **Создание Сервисов:**
    *   Скрипт начинает создавать сервисы, начиная с порта 2000.
    *   Перед созданием он получает список *всех* существующих сервисов, чтобы избежать попытки создания дубликатов. Если возникает ошибка `409` (дубликат - такой сервис существует), сервис пропускается.
    **Создание IP листов:**
    *   Генерирует уникальную подсеть `/24` (например, `10.0.1.0/24`, `10.0.2.0/24` и т.д., начиная с `STARTING_NETWORK_BASE`).
    *   Формирует имя списка (AutoGen_Net_1_10.0.X.0`).
    *   Проверяет, существует ли список с таким именем. Если да - использует существующий ID. Если нет - создает новый и получает его ID.
    *   Обрабатываются ошибки `409` (дубликат) и другие. Дубликаты пропускает.

3.  **Генерация Комбинаций и Подготовка Правил:**
    *   Используется генерации всех возможных *упорядоченных* пар Ip листов, где `src_list_id` не равно `dst_list_id`. Это гарантирует уникальность комбинаций источника и назначения для правил.
    *   Если общее количество возможных комбинаций меньше, чем `NUM_RULES`, выводится предупреждение, и создаются все доступные комбинации.
    *   Полученный список комбинаций случайным образом перемешивается (`random.shuffle`).

4.  **Создание Правил Межсетевого Экрана (с адаптивным пакетом):**
    *   Подготавливается цикл для создания правил группами (`batch), отправляет за один запрос пачку правил.
    *   Используется начальный `BATCH_SIZE` (например, 1000).
        *   **Адаптивный размер пакета:** Если при создании группы возникает ошибка `113` (превышение лимита элементов в запросе), размер пакета уменьшается вдвое (но не меньше 1), и скрипт продолжает работу с новым, меньшим размером пакета. Это позволяет обойти ограничения API на количество объектов в одном вызове.
    * После создания основных правил, скрипт создает одно финальное правило с именем `Any_to_Any`, которое разрешает весь остальной трафик. Предназзначено для использования в нагрузочном тестировании.

5. **Финализация и Отчет:**
    *   На всех этапах работы генератора правил используется прогресс-бар `tqdm`.
    *   Выводится отчет в консоль (количество созданных объектов, время работы, количество ошибок).
    *   Итоговый отчет записывается в файл `api.log` с подробным логированием.

6. **Очистка всех обьектов и правил (cleanup_firewall.py)**
    *  В комплекте присутстует cleanup_firewall.py - который полностью удаляет все обьекты и правила созданные генератором правил.
    *  Запуск и настройка cleanup производится отдельно от generator_firewall.py по аналогичной инструкции п.1.
    *  После завершения выволнения скрипта cleanup возможно просмотреть подробные логи в файле api_cleanup.log.